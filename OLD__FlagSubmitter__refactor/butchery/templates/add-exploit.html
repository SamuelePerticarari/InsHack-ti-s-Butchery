{% extends 'base_template.html' %}

{% block header %}
<h1>{% block title %}New exploit{% endblock %}</h1>
{% endblock %}

{% block content %}

{% if message %}
{% include 'components/flask-messages.html' %}
{% endif %}

<div class="row">

    <div class="col-md-10 offset-md-1 mt-2 mb-3">

        {% if not CHALLENGES_DATA | length %}

        <div style="padding:10px">

            No challenges present.

        </div>

        {% else %}


        <div class="card">
            <div class="card-header primary">
                Add a new exploit
            </div>
            <div class="card-content mt-2 container">


                <form method="post" enctype="multipart/form-data">

                    <div class="form-group">

                        <label for="challenge_id">Challenge</label>
                        <select class="form-control custom-select" name="challenge_id" id="challenge_id" required>
                            {% for challenge in CHALLENGES_DATA %}
                            <option value="{{ challenge['id'] }}"> {{ challenge['name'] }}:{{ challenge['port'] }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="exploit_version">Exploit version</label>
                        <input type="text" name="exploit_version" class="form-control" id="exploit_version"
                               aria-describedby="exploitVersionHelp" placeholder="1.0" required>
                        <small id="exploitVersionHelp" class="form-text text-muted">Enter the exploit version.</small>
                    </div>

                    <div class="form-group">
                        <label for="exploit_command">Exploit command</label>
                        <input type="text" name="exploit_command" class="form-control" id="exploit_command"
                               aria-describedby="exploitCommandHelp" placeholder="python solve.py">
                        <small id="exploitCommandHelp" class="form-text text-muted">Enter the command to execute.
                        </small>
                    </div>

                    <div class="custom-file">
                        <label class="custom-file-label" for="exploit_files">Exploit files</label>
                        <input type="file" class="custom-file-input" id="exploit_files" name="exploit_files[]"
                               aria-describedby="exploitFilesHelp" multiple="" required>
                        <small id="exploitFilesHelp" class="form-text text-muted">Choose the exploit files.</small>
                    </div>

                    <button type="submit" class="btn btn-primary btn-large mb-3 mt-3 width-100">Upload exploit</button>

                </form>

            </div>
        </div>

        {% endif %}

    </div>


    <div class="col-md-12 mb-5 mt-2">


        <ul class="list-group">
            {% if not EXPLOITS_DATA | length %}

            <li class="list-group-item active disabled" aria-disabled="true">
              <span class="h3">
                No exploits present.
              </span>
            </li>

            {% else %}

            <li class="list-group-item active disabled" aria-disabled="true">
                <span class="h4">Exploits</span>
            </li>

            <li class="list-group-item">


                <table class="table table-bordered text-center mt-3">

                    <thead>
                    <tr>
                        <th scope="col">
                            Challenge
                        </th>
                        <th scope="col">
                            Exploits
                        </th>
                    </tr>
                    </thead>

                    <tbody>

                    {% for exploit in EXPLOITS_DATA %}
                    <tr>
                        <td> {{ exploit['challenge_name'] }}:{{ exploit['challenge_port'] }}</td>
                        <td>
                            {% if not exploit['exploits'] | length %}

                            No exploits found.

                            {% else %}


                            <table class="table table-bordered text-center mt-1">

                                <thead>
                                <tr>
                                    <th scope="col">
                                        #
                                    </th>
                                    <th scope="col">
                                        Status
                                    </th>
                                    <th scope="col">
                                        Version
                                    </th>
                                    <th scope="col">
                                        Files
                                    </th>
                                    <th scope="col">
                                        Owner
                                    </th>
                                    <th scope="col">
                                        Uploaded at
                                    </th>
                                </tr>
                                </thead>

                                <tbody>

                                {% for exploit_obj in exploit['exploits'] %}
                                <tr>
                                    <th>
                                        {{ exploit_obj['id'] }}
                                    </th>
                                    <td>
                                        {% if exploit_obj['enabled'] == 1 %}
                                        <span class="badge badge-success">Enabled</span>
                                        {% else %}
                                        <span class="badge badge-danger">Disabled</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {{ exploit_obj['version'] }}
                                    </td>
                                    <td>
                                        {% for path in exploit_obj['path'].split('-_-*+*-_-') %}
                                        <form action="{{ url_for('base.get_file') }}" method="post"
                                              class="width-100 mb-1">
                                            <input type="hidden" name="path" value="{{ path }}">
                                            <input type="submit" name="" value="{{ path[24:] }}"
                                                   class="btn btn-primary">
                                        </form>
                                        {% endfor %}
                                    </td>
                                    <td>
                                        {{ exploit_obj['owner'] }}
                                    </td>
                                    <td>
                                        {{ exploit_obj['timestamp'] }}
                                    </td>
                                </tr>
                                {% endfor %}

                                </tbody>

                            </table>

                            {% endif %}

                        </td>
                    </tr>

                    {% endfor %}

                    </tbody>

                </table>


            </li>
            {% endif %}


        </ul>

    </div>

</div>

{% endblock %}
